--- a/setup.sh
+++ b/setup.sh
@@ -7,6 +7,23 @@
 
 set -euo pipefail
 
+# Determine REPO_ROOT (absolute path) at script start
+REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
+# If main.tf not in script directory, search upward
+if [ ! -f "$REPO_ROOT/main.tf" ]; then
+    search_dir="$REPO_ROOT"
+    while [ "$search_dir" != "/" ]; do
+        if [ -f "$search_dir/main.tf" ]; then
+            REPO_ROOT="$search_dir"
+            break
+        fi
+        search_dir="$(dirname "$search_dir")"
+    done
+fi
+
 # Configuration
 SCRIPT_VERSION="1.0.0"
 LOG_FILE="/tmp/thinkdeploy-setup-$(date +%Y%m%d-%H%M%S).log"
 VALIDATION_TIMEOUT="${VALIDATION_TIMEOUT:-20}"  # 20 seconds default
+
+# Set persistent tfvars paths (absolute, based on REPO_ROOT)
+GENERATED_DIR="$REPO_ROOT/generated"
+TFVARS_FILE="$GENERATED_DIR/thinkdeploy.auto.tfvars.json"
 
 # Redirect all output to log file AND screen
 exec > >(tee -a "$LOG_FILE") 2>&1
@@ -1588,20 +1605,12 @@ fi
 
 # Build terraform variables JSON file (safer than command-line args)
 # This will be used for both plan and apply
-# Use persistent location inside repo: ./generated/thinkdeploy.auto.tfvars.json
-script_dir_tfvars="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
-TF_ROOT_TFVARS="$script_dir_tfvars"
-if [ ! -f "$TF_ROOT_TFVARS/main.tf" ]; then
-    search_dir_tfvars="$TF_ROOT_TFVARS"
-    while [ "$search_dir_tfvars" != "/" ]; do
-        if [ -f "$search_dir_tfvars/main.tf" ]; then
-            TF_ROOT_TFVARS="$search_dir_tfvars"
-            break
-        fi
-        search_dir_tfvars="$(dirname "$search_dir_tfvars")"
-    done
-fi
-
-GENERATED_DIR="$TF_ROOT_TFVARS/generated"
-mkdir -p "$GENERATED_DIR" || error_exit "Failed to create generated directory: $GENERATED_DIR"
-TFVARS_FILE="$GENERATED_DIR/thinkdeploy.auto.tfvars.json"
+# Note: REPO_ROOT, GENERATED_DIR, and TFVARS_FILE are set at script start (absolute paths)
 
 build_tfvars_file() {
+    # Ensure GENERATED_DIR exists (absolute path based on REPO_ROOT)
+    mkdir -p "$GENERATED_DIR" || error_exit "Failed to create generated directory: $GENERATED_DIR"
+    
+    # Verify TFVARS_FILE is absolute path
+    if [[ "$TFVARS_FILE" != /* ]]; then
+        error_exit "TFVARS_FILE must be absolute path, got: $TFVARS_FILE"
+    fi
     # Build JSON object for all terraform variables
     local TFVARS_JSON="{"
     
@@ -1675,11 +1684,20 @@ build_tfvars_file() {
     
     # Validate JSON and write to file (using absolute path)
     if ! echo "$TFVARS_JSON" | jq . > "$TFVARS_FILE" 2>/dev/null; then
-        error_exit "Failed to create valid tfvars JSON file"
+        error_exit "Failed to create valid tfvars JSON file at: $TFVARS_FILE"
     fi
     
+    # Immediately verify file exists
+    if [ ! -f "$TFVARS_FILE" ]; then
+        error_exit "Tfvars file was not created: $TFVARS_FILE"
+    fi
+    
     # Set secure permissions (contains secrets)
     chmod 600 "$TFVARS_FILE" || warning "Failed to set permissions on tfvars file"
     
     # Write pointer file for easy reference
-    echo "$TFVARS_FILE" > "$TF_ROOT_TFVARS/.thinkdeploy_last_tfvars" 2>/dev/null || true
+    echo "$TFVARS_FILE" > "$REPO_ROOT/.thinkdeploy_last_tfvars" 2>/dev/null || true
     
     log "Created tfvars file: $TFVARS_FILE"
+    log "File verification: $(ls -la "$TFVARS_FILE" 2>/dev/null || echo 'FILE NOT FOUND')"
+    echo "âœ… Tfvars file created: $TFVARS_FILE" 1>&2
+    echo "   $(ls -lh "$TFVARS_FILE" 2>/dev/null | awk '{print $1, $5, $9}')" 1>&2
     
     # If Deploy All was selected, deploy immediately
     if [ "${DEPLOY_ALL_SELECTED:-false}" = "true" ]; then
-        # Determine TF_ROOT
-        script_dir_deploy="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
-        TF_ROOT="$script_dir_deploy"
-        if [ ! -f "$TF_ROOT/main.tf" ]; then
-            search_dir_deploy="$TF_ROOT"
-            while [ "$search_dir_deploy" != "/" ]; do
-                if [ -f "$search_dir_deploy/main.tf" ]; then
-                    TF_ROOT="$search_dir_deploy"
-                    break
-                fi
-                search_dir_deploy="$(dirname "$search_dir_deploy")"
-            done
-        fi
+        # Use REPO_ROOT as TF_ROOT (already set at script start)
+        TF_ROOT="$REPO_ROOT"
         
         # Count enabled VMs
         enabled_vms=$(jq -r '.vms // {} | to_entries | map(select(.value.enabled==true)) | length' "$TFVARS_FILE" 2>/dev/null || echo "0")
@@ -1710,19 +1728,12 @@ run_terraform_deploy() {
 run_terraform_deploy() {
     local tfvars_file="$1"
     
-    # Determine Terraform root directory (where setup.sh is located)
-    local script_dir
-    script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
-    local TF_ROOT="$script_dir"
-    
-    # If setup.sh may be executed from subdir, locate main.tf
-    # Search upward from script directory if main.tf not found
-    if [ ! -f "$TF_ROOT/main.tf" ]; then
-        local search_dir="$TF_ROOT"
-        while [ "$search_dir" != "/" ]; do
-            if [ -f "$search_dir/main.tf" ]; then
-                TF_ROOT="$search_dir"
-                break
-            fi
-            search_dir="$(dirname "$search_dir")"
-        done
-    fi
+    # Use REPO_ROOT as TF_ROOT (already set at script start)
+    local TF_ROOT="$REPO_ROOT"
+    
+    # Convert tfvars_file to absolute path if relative
+    if [[ "$tfvars_file" != /* ]]; then
+        tfvars_file="$(cd "$(dirname "$tfvars_file")" && pwd)/$(basename "$tfvars_file")"
+    fi
     
     # Guards - fail fast
-    [ -f "$tfvars_file" ] || error_exit "tfvars not found: $tfvars_file"
+    [ -f "$tfvars_file" ] || error_exit "tfvars not found: $tfvars_file (absolute path: $tfvars_file)"
     
@@ -2457,7 +2468,7 @@ else
     echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" 1>&2
     echo "" 1>&2
-    echo "ðŸ“‹ Configuration saved. Run these commands when ready:" 1>&2
+    echo "ðŸ“‹ Configuration saved. Run these commands when ready (from any directory):" 1>&2
     echo "  terraform plan -var-file=\"$TFVARS_FILE\"" 1>&2
     echo "  terraform apply -var-file=\"$TFVARS_FILE\" -auto-approve" 1>&2
     echo "" 1>&2
-    echo "ðŸ“‹ Persistent tfvars location: $TFVARS_FILE" 1>&2
+    echo "ðŸ“‹ Persistent tfvars location (absolute path): $TFVARS_FILE" 1>&2
     if [ -f "$REPO_ROOT/.thinkdeploy_last_tfvars" ]; then
         LAST_TFVARS=$(cat "$REPO_ROOT/.thinkdeploy_last_tfvars" 2>/dev/null || echo "")
         if [ -n "$LAST_TFVARS" ] && [ "$LAST_TFVARS" != "$TFVARS_FILE" ]; then
             echo "â„¹ï¸  Previous tfvars file: $LAST_TFVARS" 1>&2
         fi
     fi
     echo "ðŸ“‹ Last tfvars pointer: $REPO_ROOT/.thinkdeploy_last_tfvars" 1>&2
@@ -2437,7 +2448,7 @@ else
-            echo "ðŸ”„ Rerun commands:" 1>&2
+            echo "ðŸ”„ Rerun commands (from any directory, using absolute path):" 1>&2
             echo "  terraform plan -var-file=\"$TFVARS_FILE\"" 1>&2
             echo "  terraform apply -var-file=\"$TFVARS_FILE\" -auto-approve" 1>&2
             echo "" 1>&2
-            echo "ðŸ“‹ Persistent tfvars file: $TFVARS_FILE" 1>&2
+            echo "ðŸ“‹ Persistent tfvars file (absolute path): $TFVARS_FILE" 1>&2
             
-            # Cleanup tfvars file ONLY after successful apply AND state is non-empty
-            rm -f "$TFVARS_FILE" 2>/dev/null || true
-            log "Cleaned up tfvars file (contains sensitive data)"
+            # Keep tfvars file with secure permissions (contains secrets but needed for reruns)
+            chmod 600 "$TFVARS_FILE" 2>/dev/null || true
+            log "Tfvars file kept with secure permissions (contains sensitive data): $TFVARS_FILE"
+            echo "âš ï¸  Tfvars file contains sensitive data. Keep it secure (chmod 600)." 1>&2
@@ -2485,7 +2496,7 @@ log "Script execution completed"
-    echo "ðŸ”„ Rerun commands:" 1>&2
+    echo "ðŸ”„ Rerun commands (from any directory, using absolute path):" 1>&2
     echo "  terraform plan -var-file=\"$TFVARS_FILE\"" 1>&2
     echo "  terraform apply -var-file=\"$TFVARS_FILE\" -auto-approve" 1>&2
     echo "" 1>&2
-    echo "ðŸ“‹ Persistent tfvars file: $TFVARS_FILE" 1>&2
+    echo "ðŸ“‹ Persistent tfvars file (absolute path): $TFVARS_FILE" 1>&2
     echo "ðŸ“‹ Last tfvars pointer: $REPO_ROOT/.thinkdeploy_last_tfvars" 1>&2
